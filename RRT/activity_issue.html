<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>发布活动</title>
		<link rel="stylesheet" type="text/css" href="css/init.css" />
		<link rel="stylesheet" type="text/css" href="css/common.css?v=3" />
		<!--年月日时分 插件-->
		<link rel="stylesheet" type="text/css" href="style/mobiscroll.2.13.2.css" />
		<!--省份 插件-->
		<link rel="stylesheet" type="text/css" href="style/LArea_activity.css" />

		<link rel="stylesheet" type="text/css" href="css/activity_issue.css?v=2018111006" />

		<script type="text/javascript">
			(function() {
				function o() {
					document.documentElement.style.fontSize = (document.documentElement.clientWidth < 540 ? document.documentElement.clientWidth : 540) / 750 * 100 + 'px';
				}
				var e = null;
				window.addEventListener("resize", function() {
					clearTimeout(e), e = setTimeout(o, 300)
				}, !1), o()
			})(window);
		</script>
	</head>

	<body>
		<div class="renrenyouting">
			<div class="top">
				<a class="back" href=""><span class="back-arr"></span></a>
				<h2>发布活动</h2>
			</div>
			<div class="content">
				<div class="act_cover">
					<div class="cover-container">
						<img class="cover-img hide" src="img/chuan2.png" />
					</div>
					<div class="upload-container">
						<ul class="img-list">
							
							<li class="img-item">
								<div class="img-ctn">
									<img src="img/chuan1.png" />
								</div>
								<i class="delete-img"></i>
							</li>
							
							<li class="img-item add-pic">
								<input type="file" name="img" id="file" value="" accept="image/*" />
							</li>
						</ul>
					</div>

				</div>

				<div class="fill-container">
					<div class="fill-item margin-t1">
						<div class="fill-title">基本信息</div>
						<ul class="list-content">
							<li class="list-item act-name-cont">
								<div class="act-name-t"><i></i><span>活动名称</span><i></i></div>
								<input class="" type="text" name="" id="" value="" placeholder="请给你的活动起个名称"  />
							</li>
							<li class="list-item">
								<span class="item-l"><i class="icon-t1"></i><em>开始时间：</em></span>
								<input class="ipt-com ipt-w2 ipt-time ipt-num demo-test-date demo-test-datetime demo-test-time demo-test-credit" type="text" name="" id="" value="" onfocus="this.blur();" placeholder="" />
							</li>
							<li class="list-item">
								<span class="item-l"><i class="icon-t1"></i><em>结束时间：</em></span>
								<input class="ipt-com ipt-w2 ipt-time ipt-num demo-test-date demo-test-datetime demo-test-time demo-test-credit" type="text" name="" id="" value="" onfocus="this.blur();" placeholder="" />
								<span class="total-time">共12.5小时</span>
							</li>
							<li class="list-item">
								<span class="item-l"><i class="icon-t2"></i><em>活动城市：</em></span>
								<span class="party-city">广州</span>
								<input class="ipt-city" id="citySelector" type="text" name="" id="" value="" onfocus="this.blur();" />
								<input type="hidden" id="cityValue" />
							</li>
							<li class="list-item position">
								<span class="item-l"><i class="icon-t3"></i><em>上艇位置：</em></span>
								<input class="ipt-com ipt-w1 showframe" type="text" name="" id="" value="" placeholder="填写上艇位置" />
								<!---推荐选择弹框--->
								<div class="opt-wrap hide">
									<ul class="opt-list">
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">暂无</span>
											</div>
										</li>
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">广州芳村码头</span>
											</div>
										</li>
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">广州芳村码头</span>
											</div>
										</li>
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">广州芳村码头</span>
											</div>
										</li>
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">广州芳村码头</span>
											</div>
										</li>
									</ul>
								</div>
							</li>
							<li class="list-item position">
								<span class="item-l"><i class="icon-t4"></i><em>游艇名称：</em></span>
								<input class="ipt-com ipt-w1 showframe" type="text" name="" id="" value="" placeholder="填写游艇名称" />
								<!---推荐选择弹框--->
								<div class="opt-wrap hide">
									<ul class="opt-list">
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">暂无</span>
											</div>
										</li>
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">super游艇</span>
											</div>
										</li>
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">super游艇</span>
											</div>
										</li>
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">super游艇</span>
											</div>
										</li>
										<li class="opt-item">
											<i class="point"></i>
											<div class="opt-exp">
												<span class="opt-cont">super游艇</span>
											</div>
										</li>
									</ul>
								</div>
							</li>
							
						</ul>
					</div>

					<div class="fill-item margin-t1">
						<div class="fill-title">活动要求</div>
						<ul class="list-content margin-t1">
							
							<li class="list-item">
								<span class="item-l"><i class="icon-t5"></i><em>性别要求：</em></span>
								<div class="sex-opt">
									<span class="sex-item active"><!--选中状态添加class: .active-->
										<i class="nosex"></i>不限
									</span>
									<span class="sex-item">
										<i class="man"></i>男
									</span>
									<span class="sex-item">
										<i class="woman"></i>女
									</span>
								</div>
							</li>
							<li class="list-item">
								<span class="item-l"><i class="icon-t6"></i><em>活动人数：</em></span>
								<input class="ipt-com ipt-w1 ipt-num" type="number" name="" id="" value="" placeholder="请注意游艇限载人数" />
							</li>
							<li class="cost-item">
								<span class="item-l"><i class="icon-t7"></i><em>费用类型：</em></span>
								<div class="cost-opt">
									<span class="active">AA</span>
									<span class="">免费</span>
									<br />
									<span class="">男A女免</span>
									<span class="">女A男免</span>
									</p>
								</div>
							</li>

							<li class="list-item">
								<span class="item-l"><i class="icon-t8"></i><em>参与费用：</em></span>
								<input class="ipt-com ipt-w1 ipt-num cost_rmb" type="text" name="" id="" value="" placeholder="A方人均" />
							</li>
							
							<li class="list-item">
								<span class="item-l"><i class="icon-t9"></i><em>实名认证：</em></span>
								<div class="need-opt">
									<span class="active">不需要</span>
									<span class="">需要</span>
								</div>
							</li>
							<li class="list-item">
								<span class="item-l"><i class="icon-t10"></i><em>报名审核：</em></span>
								<div class="need-opt">
									<span class="active">系统自动</span>
									<span class="">发布人审核</span>
								</div>
							</li>
						</ul>
					</div>
					<div class="des-container">
						<textarea class="textarea" placeholder="描述："></textarea>
					</div>
					<div class="fill-item margin-t1 no-padding-t">
						<ul class="list-content margin-t1">
							<li class="list-item">
								<span class="item-l"><i class="icon-t11"></i><em>手机号码：</em></span>
								<input class="ipt-com ipt-w1 ipt-num" type="number" name="" id="" value="" placeholder="" />
							</li>
							<li class="list-item">
								<span class="item-l"><i class="icon-t12"></i><em>验证码：</em></span>
								<input class="ipt-com ipt-w2 ipt-num" type="number" name="" id="" value="" placeholder="" />
								<a class="get-code">获取验证码</a><!-- 发送验证码之后展示  剩余60s  倒计时--->
							</li>
						</ul>
					</div>
					
					<div class="footer-btn">
						<div class="foot-l">
							<p class="clause">
								<i class="active"></i> <!--勾选中 添加样式 active-->
								<span>已阅读并同意</span>
								<em>活动发布条款</em>
							</p>
						</div>
						<div class="foot-r">发布</div>
					</div>
					
				</div>

				<div class="gb hide"></div>
				<!--半透明背景，弹框需要显示-->

				<!--活动条款-->
				<div class="agreement hide">
					<span class="off-agreement"></span>
					<h2 class="agreement-h">人人艇活动条款</h2>
					<div class="agreement-cont">
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
					</div>
				</div>

			</div>

			<!---轮播图--->
			<div class="owing-wrap hide">
				<p class="pic-num">1/4</p>
				<div class="pic-container">
					<ul class="pic-list">
						<li class="pic-item"><img src="http://www.rryouting.com/YachtPic/2018/100009.jpg" /></li>
						<li class="pic-item"><img src="http://www.rryouting.com/YachtPic/2018/100009.jpg" /></li>
						<li class="pic-item"><img src="http://www.rryouting.com/YachtPic/2018/100009.jpg" /></li>
					</ul>
				</div>
				<div class="off-owing"></div>
			</div>

			<!--日历时间插件必须用到，不可删除--->
			<div class="settings" style="display:none;">
				<select name="demo" id="demo">
					<option value="date">日期</option>
				</select>
			</div>

			<!--图像裁剪--->
			<div class="clipbg">
				<div class="clip-area" id="clipArea"></div>
				<div class="footer">
					<dl>
						<dd class="oper-item active" id="clipBtn">确认</dd>
						<dd class="oper-item" id="cancelBtn">取消</dd>
					</dl>
				</div>
				<div class="loading">正在载入图片...</div>
			</div>

		</div>
	</body>
	<!--年月日时分插件--->
	<script src="js/jquery-1.12.4.js" type="text/javascript"></script>
	<script src="script/mobiscroll.2.13.2.js?v=20181121" type="text/javascript"></script>
	<!--城市插件--->
	<script src="script/LAreaData1.js" type="text/javascript"></script>
	<script src="script/LAreaData2.js" type="text/javascript"></script>
	<script src="script/LArea.js" type="text/javascript"></script>
	<!--图像裁剪插件--->
	<script src="script/hammer.min.js" type="text/javascript"></script>
	<script src="script/lrz.all.bundle.js" type="text/javascript"></script>
	<script src="script/iscroll-zoom-min.js" type="text/javascript"></script>
	<script src="script/PhotoClip.js" type="text/javascript"></script>

	<script type="text/javascript">
		$(function() {
			/*上艇位置，游艇名字；推荐弹框*/
			var top = 0; //给top变量一个初始值，以便下方赋值并引用。
			$(".showframe").on("focus click", function() { //输入框 聚焦，推荐弹框出现；
				if($(this).next(".opt-wrap").css("display") == "none") {
					$(this).next(".opt-wrap").show(); //输入框对应的 推荐弹框 显示；
					/*弹框出现，禁止body滚动*/
					top = $(this).parents(".list-item").offset().top - $(".top").height();
					$('body').css("top", -top + "px"); //给body一个负的top值；
					$('body').css("position", "fixed"); //给body设置，position:fixed; 
				}
			})
			$(".showframe").on("input", function() { //输入框 输入状态，推荐弹框消失；
				$(".opt-wrap").hide();
				/*弹框消失，恢复body滚动*/
				$('body').css("position", "static"); //给body设置，position:static; 
				$('body').scrollTop(top); //不设置，body 会滚回顶部，
			})
			$(document).on("touchstart touchmove", function(ev) { //控制 推荐弹框的 隐藏；
				var ev = ev || window.event;
				var target = ev.target;
				if(!$(target).parents(".opt-wrap").is(".opt-wrap") &&
					!$(target).is(".showframe")
				) {
					if($(".opt-wrap").eq(0).css("display") == "block") {
						$(".opt-wrap").eq(0).hide();
						/*弹框消失，恢复body滚动*/
						$('body').css("position", "static"); //给body设置，position:static; 
						$('body').scrollTop(top); //不设置，body 会滚回顶部，
					}
					if($(".opt-wrap").eq(1).css("display") == "block") {
						$(".opt-wrap").eq(1).hide();
						/*弹框消失，恢复body滚动*/
						$('body').css("position", "static"); //给body设置，position:static; 
						$('body').scrollTop(top); //不设置，body 会滚回顶部，
					}
				}
			})
			$(".opt-list").find(".opt-item").click(function() { //选中推荐框内容，渲染html上
				var html = $(this).find(".opt-cont").html();
				$(this).parents(".list-item").find(".showframe").val(html);
				$(".opt-wrap").hide();
				/*弹框消失，恢复body滚动*/
				$('body').css("position", "static"); //给body设置，position:static; 
				$('body').scrollTop(top); //不设置，body 会滚回顶部，
			})

			/*图像裁剪插件*/
			var clipArea = new PhotoClip("#clipArea", {
				size: [300, 214], //裁剪框大小
				outputSize: [0, 0], //打开图片大小，[0,0]表示原图大小
				file: "#file",
				ok: "#clipBtn",
				loadStart: function() { //图片开始加载的回调函数。this 指向当前 PhotoClip 的实例对象，并将正在加载的 file 对象作为参数传入。（如果是使用非 file 的方式加载图片，则该参数为图片的 url）
					$(".loading").show(); //正在载入图片……；
					$(".clipbg").fadeIn(); //裁剪框显示；
				},
				loadComplete: function() { //图片加载完成的回调函数。this 指向当前 PhotoClip 的实例对象，并将图片的 <img> 对象作为参数传入。
					$(".loading").hide(); //载入图片成功，则隐藏……；
					$(".clipbg").fadeIn(); //裁剪框显示；
				},
				done: function(dataURL) { //裁剪完成的回调函数。this 指向当前 PhotoClip 的实例对象，会将裁剪出的图像数据DataURL作为参数传入。			
					console.log(dataURL); //dataURL裁剪后图片地址base64格式提交给后台处理;
					$(".clipbg").fadeOut();
					var blob = dataURItoBlob(dataURL); // base64 转化为 二进制 的图像信息；
					console.log(blob);
					var fd = new FormData();
					fd.append("upload_file", blob, 'image.png'); //上面的upload_file为这个文件的key，等效于input中的name，image.png则是文件名，由于base64的图片信息是不带文件名的，所以可以手动指定一个，这个参数是可选的
					fd.append('pc_token', "1511408478754e97915fe6e7ea5c1b62cc12d96272");
					$.ajax({
						url: '',
						type: 'POST',
						processData: false, // 必须, 告诉jQuery不要去处理发送的数据
						contentType: false, // 必须, 告诉jQuery不要去设置Content-Type请求头
						dataType: 'json',
						data: fd,
						success: function(data) {},
						error: function(msg) {}
					});
				}
			});
			$("#cancelBtn").click(function() { //取消裁剪，裁剪框隐藏；
				$(".clipbg").fadeOut();
				$("#file").val(""); //虽然file的value不能设为有字符的值，但是可以设置为空值;
			});

			//将base64转换成二进制图片（Blob）
			function dataURItoBlob(base64Data) {
				var byteString;
				if(base64Data.split(',')[0].indexOf('base64') >= 0) {
					byteString = atob(base64Data.split(',')[1]); // window.atob(); // 解码; window.btoa("Hello");// 编码
				} else {
					byteString = unescape(base64Data.split(',')[1]); //unescape() 函数可对通过 escape() 编码的字符串进行解码。	
				}
				var mimeString = base64Data.split(',')[0].split(':')[1].split(';')[0];
				var ia = new Uint8Array(byteString.length); //8 位无符号整数值的类型化数组。内容将初始化为 0。如果无法分配请求数目的字节，则将引发异常。
				for(var i = 0; i < byteString.length; i++) {
					ia[i] = byteString.charCodeAt(i); //charCodeAt() 方法可返回指定位置的字符的 Unicode 编码。
					//方法 charCodeAt() 与 charAt() 方法执行的操作相似，只不过前者返回的是位于指定位置的字符的编码，而后者返回的是字符子串。
				}
				return new Blob([ia], {
					type: mimeString
				});
			}

			//初始化时间；
			$(".ipt-time").attr("value", "2018-09-14 15:30"); //插件缘故，设置有效，可获取到，只是页面input不展示出来；
			$(".ipt-time").attr("placeholder", "2018-09-14 15:30"); //只是为了给用户展示默认的时间，设置placeholder即可，

			/*城市选择插件*/
			var area2 = new LArea();
			area2.init({
				'trigger': '#citySelector',
				'valueTo': '#cityValue',
				'keys': {
					id: 'value',
					name: 'text'
				},
				'type': 2,
				'data': [provs_data, citys_data] //provs_data, citys_data, dists_data  ,省份、市区、县城  的数据 可以自定义选择;
			});

			$("#citySelector").on("input", function() { //获取选择到的城市，更新到html；
				var city = $(this).val().split(",")[1];
				$(".party-city").html($(this).val());
			})

			/*日历时间插件。用法*/
			var iY = new Date().getFullYear(); //年
			var iMon = new Date().getMonth();  //月
			var iD = new Date().getDate();     //日
			var iH = new Date().getHours();    //时
			var iM = new Date().getMinutes();  //分
			
			
			var opt = {};
			opt.date = {
				preset: 'date',
			};
			opt.datetime = {
				preset: 'datetime',
				minDate: new Date(iY,iMon,iD,iH,0),  //限制选择最小的日期时间； 这里控制了 过去时间 不可选取；
//				maxDate: new Date(2018,12,20,12,0),//限制选择最大的日期时间；
			};
			opt.time = {
				preset: 'time',
				
			};
			
			var defaultValue = new Date(2018,11,20,12,0);
			
			opt.default = {
				defaultValue: defaultValue, //初始化时间
				theme: 'android-holo light', //皮肤样式
				display: 'modal', //显示方式 
				mode: 'scroller', //日期选择模式
				dateFormat: 'yyyy-mm-dd',
				lang: 'zh',
				showNow: true,
				nowText: "今天",
				stepMinute: 15,    //时间，分 的 区间 间隔数值
				startYear: iY - 0, //开始年份
				endYear: iY + 1 //结束年份
			};

			$('.settings').bind('change', function() {
				var demo = 'datetime';
				if(!demo.match(/select/i)) {
					$('.demo-test-' + demo).val('');
				}
				$('.demo-test-' + demo).scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
				$('.demo').hide();
				$('.demo-' + demo).show();
			});
			$('#demo').trigger('change');
				
			
			
			
			/*上传封面  小图  排列 超出 x轴滚动条 控制 计算*/
			
			x(); //每上传 一张 img html渲染一次， 执行该函数一次即可；
			function x(){
				var l = $(".img-list .img-item").length;  //获取个数；
				var iw = $(".img-list .img-item").eq(0).outerWidth(true); //每个小图 占去的宽度（包括margin）
				var mg = parseInt($(".img-list .img-item").eq(0).css("marginLeft"));//每个小图 的marginLeft 值；
				var scroll_x = 0; 
				$(".img-list").css("width", l*iw+mg+"px"); //计算 小图容器 实际 总长度； 大于屏幕宽度则 自动 x轴 出现滚动条
				scroll_x = (l*iw+mg)>$(".upload-container").width()?(l*iw+mg)-$(".upload-container").width():0;
				$(".upload-container").scrollLeft(scroll_x);
			}
			
			
			/*参与费用  输入框内容过滤 添加末尾 “元”字*/
			$(".cost_rmb").on("focus",function(){  //获取焦点
				$(this).val($(this).val().replace("元",""));
			})
			$(".cost_rmb").on("blur",function(){  //失去焦点
				if($(this).val()){
					$(this).val($(this).val()+"元");
				}
			})
			$(".cost_rmb").on("input",function(){
				$(this).val($(this).val().replace(/[^0-9|\.]/gi,""));
			})
		})
	</script>

</html>