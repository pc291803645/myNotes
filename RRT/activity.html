<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>发布活动</title>
		<link rel="stylesheet" type="text/css" href="css/init.css" />
		<link rel="stylesheet" type="text/css" href="css/common.css?v=3"/>
		<link rel="stylesheet" type="text/css" href="style/mobiscroll.2.13.2.css" />
		<link rel="stylesheet" type="text/css" href="style/LArea.css"/>
		<link rel="stylesheet" type="text/css" href="css/activity.css?v=13300005" />

		<script type="text/javascript">
			(function() {
				function o() {
					document.documentElement.style.fontSize = (document.documentElement.clientWidth < 540 ? document.documentElement.clientWidth : 540) / 750 * 100 + 'px';
				}
				var e = null;
				window.addEventListener("resize", function() {
					clearTimeout(e), e = setTimeout(o, 300)
				}, !1), o()
			})(window);
		</script>
	</head>

	<body>
		<div class="renrenyouting">
			<div class="top">
				<a class="back" href=""><span class="back-arr"></span></a>
				<h2>发布活动</h2>
			</div>
			<div class="content">
				<div class="fill-container">
					<ul class="list-content">
						<li class="list-item">
							<span class="item-l">活动名称：</span>
							<input class="ipt-com ipt-w1" type="text" name="" id="" value="" placeholder="请给你的活动起个名称" />
						</li>
						<li class="list-item">
							<span class="item-l">活动开始时间：</span>
							<input class="ipt-com ipt-w2 ipt-time ipt-num demo-test-date demo-test-datetime demo-test-time demo-test-credit" type="text" name="" id="" value="" onfocus="this.blur();" placeholder="" />
						</li>
						<li class="list-item">
							<span class="item-l">活动结束时间：</span>
							<input class="ipt-com ipt-w2 ipt-time ipt-num demo-test-date demo-test-datetime demo-test-time demo-test-credit" type="text" name="" id="" value="" onfocus="this.blur();" placeholder="" />
							<span class="total-time">共12.5小时</span>
						</li>
						<li class="list-item">
							<span class="item-l">活动地点：</span>
							<span class="party-city">广州</span>
							<input class="ipt-city" id="citySelector" type="text" name="" id="" value="" onfocus="this.blur();"/>
							<input type="hidden" id="cityValue"/>
						</li>
						<li class="other-item">
							<span class="item-l">是否有艇：</span>
							<div class="has-opt">
								<span class="">是</span>
								<span class="acive">否</span>
							</div>
							<div class="yacht"><!---选择"是"不显示，选择"否"显示-->
								<div class="yacht-item">
									<span class="yacht-type">豪华型</span>
									<span class="yacht-name">飞桥游艇</span>
								</div>
								<div class="yacht-item hide"><!--选择游艇弹框，选择"暂不选择"，则显示这个-->
									<p class="yacht-not">暂不选择</p>
								</div>
							</div>
						</li>
						<li class="list-item">
							<span class="item-l">上艇位置：</span>
							<input class="ipt-com ipt-w1" type="text" name="" id="" value="" placeholder="填写上艇位置" />
						</li>
						<li class="list-item">
							<span class="item-l">活动人数：</span>
							<input class="ipt-com ipt-w1 ipt-num" type="number" name="" id="" value="" placeholder="请注意游艇限载人数" />
						</li>
					</ul>

					<ul class="list-content margin-t1">
						<li class="list-item">
							<span class="item-l">性别要求：</span>
							<div class="sex-opt">
								<span class="sex-item"><!--选中状态添加class: .active-->
									<i class="man"></i>男
								</span>
								<span class="sex-item">
									<i class="woman"></i>女
								</span>
								<span class="sex-item active">
									不限
								</span>
							</div>
						</li>
						<li class="cost-item">
							<span class="item-l">费用类型：</span>
							<div class="cost-opt">
								    <span class="active">AA制</span>
									<span class="">免费</span>
								    <span class="">男A女免</span>
									<br />
									<span class="">女A男免</span>
								</p>
								
							</div>
						</li>

						<li class="list-item">
							<span class="item-l">参与费用：</span>
							<input class="ipt-com ipt-w1 ipt-num" type="number" name="" id="" value="" placeholder="A方人均" />
						</li>
						<li class="list-item">
							<span class="item-l">截止报名时间：</span>
							<input class="ipt-com ipt-w1 ipt-time ipt-num demo-test-date demo-test-datetime demo-test-time demo-test-credit" type="text" name="" id="" value="" onfocus="this.blur();" placeholder="" />
						</li>
						<li class="list-item">
							<span class="item-l">实名认证：</span>
							<div class="need-opt">
								<span class="active">需要</span>
								<span class="">不需要</span>
							</div>
						</li>
						<li class="list-item">
							<span class="item-l">审核方式：</span>
							<div class="need-opt">
								<span class="active">发起人手动</span>
								<span class="">系统自动</span>
							</div>
						</li>
						<li class="list-item">
							<span class="item-l">发起人电话：</span>
							<input class="ipt-com ipt-w1 ipt-num" type="number" name="" id="" value="" placeholder="" />
						</li>
						<li class="list-item">
							<span class="item-l">验证码：</span>
							<input class="ipt-com ipt-w2 ipt-num" type="number" name="" id="" value="" placeholder="" />
							<a class="get-code">获取验证码</a>
						</li>
					</ul>
					<div class="des-container">
						<textarea class="textarea" placeholder="描述："></textarea>
					</div>

					<ul class="img-list">
						<li class="img-item"><img src="img/banner3.jpg" /><i class="delete-img"></i></li>
						<li class="img-item"><img src="img/banner3.jpg" /><i class="delete-img"></i></li>
						<li class="img-item"><img src="img/banner3.jpg" /><i class="delete-img"></i></li>
						<li class="img-item add-pic">
							<input type="file" name="img" id="file" value="" accept="image/*"/>
						</li>
					</ul>

					<button class="submit">发布</button>
					<p class="clause"><i class="clause-icon agree"></i>已阅读并同意以下<em>活动条款</em></p>
					
				</div>

				<div class="gb hide"></div><!--半透明背景，弹框需要显示-->
				
				
				<!--活动条款-->
				<div class="agreement hide">
					<span class="off-agreement"></span>
					<h2 class="agreement-h">人人艇活动条款</h2>
					<div class="agreement-cont">
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
						<p>条款最终解释权为泛美，本条款最终解释权为泛美，</p>
					</div>
				</div>
				
				
				
				<!--游艇选择-->
				<div class="yacht-container hide">
					<span class="off-msg"></span>
					<h2 class="title">选择游艇</h2>
					<p class="des"><i class="des-icon"></i>所在地点：<em>广州</em></p>
					<ul class="yacht-list">
						<li class="yacht-item">
							<i class="point"></i>
							<div class="yacht-exp">
								<span class="yacht-type">豪华型</span>
								<span class="yacht-name">超级飞桥游艇</span>
							</div>
						</li>
						<li class="yacht-item">
							<i class="point"></i>
							<div class="yacht-exp">
								<span class="yacht-type">豪华型</span>
								<span class="yacht-name">SSSS飞桥游艇</span>
							</div>
						</li>
						<li class="yacht-item">
							<i class="point"></i>
							<div class="yacht-exp">
								<span class="yacht-type">豪华型</span>
								<span class="yacht-name">SSSS飞桥游艇</span>
							</div>
						</li>
						<li class="yacht-item">
							<i class="point"></i>
							<div class="yacht-exp">
								<span class="yacht-type">豪华型</span>
								<span class="yacht-name">SSSS飞桥游艇</span>
							</div>
						</li>
						<li class="yacht-item">
							<i class="point"></i>
							<div class="yacht-exp">
								<span class="yacht-type">豪华型</span>
								<span class="yacht-name">SSSS飞桥游艇</span>
							</div>
						</li>
						<li class="yacht-item">
							<i class="point"></i>
							<div class="yacht-exp">
								<span class="yacht-type">豪华型</span>
								<span class="yacht-name">SSSS飞桥游艇</span>
							</div>
						</li>
						<li class="yacht-item">
							<i class="point"></i>
							<div class="yacht-exp">
								<span class="yacht-type">豪华型</span>
								<span class="yacht-name">SSSS飞桥游艇</span>
							</div>
						</li>
						<li class="yacht-item">
							<i class="point"></i>
							<div class="yacht-exp">
								<span class="yacht-not">暂不选择</span>
							</div>
						</li>
					</ul>
				</div>
			</div>

			<!---轮播图--->
			<div class="owing-wrap hide">
				<p class="pic-num">1/4</p>
				<div class="pic-container">
					<ul class="pic-list">
						<li class="pic-item"><img src="http://www.rryouting.com/YachtPic/2018/100009.jpg"/></li>
						<li class="pic-item"><img src="http://www.rryouting.com/YachtPic/2018/100009.jpg"/></li>
						<li class="pic-item"><img src="http://www.rryouting.com/YachtPic/2018/100009.jpg"/></li>
					</ul>
				</div>
				<div class="off-owing"></div>
			</div>
			
			<!--日历时间插件必须用到，不可删除--->
			<div class="settings" style="display:none;">
				<select name="demo" id="demo">
					<option value="date">日期</option>
				</select>
			</div>
			
			<!--图像裁剪--->
			<div class="clipbg">
				<div class="clip-area" id="clipArea"></div>
				<div class="footer">
					<dl>
						<dd class="oper-item active" id="clipBtn">确认</dd>
						<dd class="oper-item" id="cancelBtn">取消</dd>
					</dl>
				</div>
				<div class="loading">正在载入图片...</div>
			</div>
			
			
		</div>
	</body>
	<!--年月日时分插件--->
	<script src="js/jquery-1.12.4.js" type="text/javascript"></script>
	<script src="script/mobiscroll.2.13.2.js" type="text/javascript"></script>
	<!--城市插件--->
	<script src="script/LAreaData1.js" type="text/javascript"></script>
	<script src="script/LAreaData2.js" type="text/javascript"></script>
	<script src="script/LArea.js" type="text/javascript"></script>
	<!--图像裁剪插件--->
	<script src="script/hammer.min.js" type="text/javascript"></script>
	<script src="script/lrz.all.bundle.js" type="text/javascript"></script>
	<script src="script/iscroll-zoom-min.js" type="text/javascript"></script>
	<script src="script/PhotoClip.js" type="text/javascript"></script>
	
	<script type="text/javascript">
		$(function() {
			/*图像裁剪插件*/
			var clipArea = new  PhotoClip("#clipArea", {
				size: [300, 214],//裁剪框大小
				outputSize:[0,0],//打开图片大小，[0,0]表示原图大小
				file: "#file",
				ok: "#clipBtn",
				loadStart: function() { //图片开始加载的回调函数。this 指向当前 PhotoClip 的实例对象，并将正在加载的 file 对象作为参数传入。（如果是使用非 file 的方式加载图片，则该参数为图片的 url）
					$(".loading").show(); //正在载入图片……；
					$(".clipbg").fadeIn();//裁剪框显示；
				},
				loadComplete: function() {//图片加载完成的回调函数。this 指向当前 PhotoClip 的实例对象，并将图片的 <img> 对象作为参数传入。
					$(".loading").hide(); //载入图片成功，则隐藏……；
					$(".clipbg").fadeIn(); //裁剪框显示；
				},
				done: function(dataURL) { //裁剪完成的回调函数。this 指向当前 PhotoClip 的实例对象，会将裁剪出的图像数据DataURL作为参数传入。			
					console.log(dataURL);//dataURL裁剪后图片地址base64格式提交给后台处理;
					$(".clipbg").fadeOut();
					var blob = dataURItoBlob(dataURL); // base64 转化为 二进制 的图像信息；
					console.log(blob);
					var fd = new FormData();
					fd.append("upload_file", blob, 'image.png'); //上面的upload_file为这个文件的key，等效于input中的name，image.png则是文件名，由于base64的图片信息是不带文件名的，所以可以手动指定一个，这个参数是可选的
					fd.append('pc_token',"1511408478754e97915fe6e7ea5c1b62cc12d96272");
					$.ajax({
						url: '',
						type: 'POST',
						processData: false, // 必须, 告诉jQuery不要去处理发送的数据
						contentType: false, // 必须, 告诉jQuery不要去设置Content-Type请求头
						dataType: 'json',
						data: fd,
						success:function(data){},
						error:function(msg){}
					});
				}
			});
			$("#cancelBtn").click(function(){//取消裁剪，裁剪框隐藏；
				$(".clipbg").fadeOut();
				$("#file").val("");//虽然file的value不能设为有字符的值，但是可以设置为空值;
			}); 
			
			//将base64转换成二进制图片（Blob）
			function dataURItoBlob(base64Data) {   
				var byteString;
				if (base64Data.split(',')[0].indexOf('base64') >= 0){
					byteString = atob(base64Data.split(',')[1]);   // window.atob(); // 解码; window.btoa("Hello");// 编码
				}else{
					byteString = unescape(base64Data.split(',')[1]);//unescape() 函数可对通过 escape() 编码的字符串进行解码。	
				}
				var mimeString = base64Data.split(',')[0].split(':')[1].split(';')[0];
				var ia = new Uint8Array(byteString.length);	//8 位无符号整数值的类型化数组。内容将初始化为 0。如果无法分配请求数目的字节，则将引发异常。
				for (var i = 0; i < byteString.length; i++) {
					ia[i] = byteString.charCodeAt(i);  //charCodeAt() 方法可返回指定位置的字符的 Unicode 编码。
					//方法 charCodeAt() 与 charAt() 方法执行的操作相似，只不过前者返回的是位于指定位置的字符的编码，而后者返回的是字符子串。
				}
				return new Blob([ia], {type:mimeString});
			}			
			
			
			
			
			
			
			
			
			//初始化时间；
			$(".ipt-time").attr("value","2018-09-14 15:30");  //插件缘故，设置有效，可获取到，只是页面input不展示出来；
			$(".ipt-time").attr("placeholder","2018-09-14 15:30"); //只是为了给用户展示默认的时间，设置placeholder即可，
			
			//选择游艇弹框，动画，从下往上
			var iH = $(".yacht-container").innerHeight();
			var top = 0;//给top变量一个初始值，以便下方赋值并引用。
			
			//选择游艇弹框出现；
			$(".has-opt span:last").click(function(){
				$(".gb").show();
				$(".yacht-container").show().css("bottom",-iH).stop().animate({
					bottom:0
				},300,"linear");
				
				/*弹框出现，禁止body滚动*/
				top = $(window).scrollTop();//获取页面的scrollTop；
				$('body').css("top",-top+"px");//给body一个负的top值；
				$('body').css("position","fixed");//给body设置，position:fixed; 
			})
			//选择游艇弹框消失；
			$(".gb,.off-msg").click(function(){
				$(".yacht-container").hide();
				$(".gb").hide();
				
				/*弹框消失，恢复body滚动*/
				$('body').css("position","static");//给body设置，position:static; 
				$(window).scrollTop(top);//设置页面滚动的高度，如果不设置，关闭弹出层时页面会回到顶部。
			})
			
			
			
			/*城市选择插件*/
			var area2 = new LArea();
		    area2.init({
		        'trigger': '#citySelector',
		        'valueTo': '#cityValue',
		        'keys': {
		            id: 'value',
		            name: 'text'
		        },
		        'type': 2,
		        'data': [provs_data, citys_data, dists_data]
		    });
			
			$("#citySelector").on("input",function(){ //获取选择到的城市，更新到html；
				var city = $(this).val().split(",")[1];
				$(".party-city").html($(this).val());
			})
			
			
			/*日历时间插件。用法*/
			var curr = new Date().getFullYear();
			var opt = {};
			opt.date = {
				preset: 'date'
			};
			opt.datetime = {
				preset: 'datetime'
			};
			opt.time = {
				preset: 'time'
			};

			opt.default = {
				theme: 'android-holo light', //皮肤样式
				display: 'modal', //显示方式 
				mode: 'scroller', //日期选择模式
				dateFormat: 'yyyy-mm-dd',
				lang: 'zh',
				showNow: true,
				nowText: "今天",
				stepMinute: 15,
				startYear: curr - 0, //开始年份
				endYear: curr + 0 //结束年份
			};
			$('.settings').bind('change', function() {
				var demo = 'datetime';
				if(!demo.match(/select/i)) {
					$('.demo-test-' + demo).val('');
				}
				$('.demo-test-' + demo).scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
				$('.demo').hide();
				$('.demo-' + demo).show();
			});
			$('#demo').trigger('change');
			
			
			
			
			
		})
	</script>

</html>